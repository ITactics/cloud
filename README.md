# Ansible Плейбук: Настройка SSH и создание пользователя

## Описание

Этот Ansible плейбук предназначен для автоматической настройки SSH, создания нового пользователя и отключения входа под пользователем root на удаленном хосте. Он использует vault для безопасного хранения конфиденциальных данных, таких как пароли и SSH-ключи.

## Задачи

### Include encrypted variables

Эта задача подключает зашифрованные переменные, такие как пароли и SSH-ключи, из файла `secrets.vault`. Они будут использоваться в других задачах для обеспечения безопасности и конфиденциальности.

### Создание нового пользователя

С помощью этой задачи создается новый пользователь cloudru на удаленном хосте. Пароль для этого пользователя берется из зашифрованных переменных.

### Include the encrypted SSH public key

Эта задача подключает зашифрованный публичный SSH-ключ пользователя из файла ssh_keys.vault. Он будет использоваться для разрешения аутентификации по ключу для пользователя cloudru.

### Разрешить аутентификацию на основе ключей SSH для нового пользователя

Задача разрешает аутентификацию на основе ключей SSH для нового пользователя cloudru. Публичный ключ будет взят из зашифрованных переменных. Это повысит безопасность, так как вход по паролю будет отключен.

### Отключить root-вход по SSH

Эта задача отключает возможность входа под пользователем root через SSH, устанавливая опцию PermitRootLogin в значение no в файле /etc/ssh/sshd_config. Это повышает безопасность, так как уменьшает возможность атак на удаленный хост.

## Handlers

### Restart SSH

handler перезапускает службу SSH (sshd), чтобы внести изменения в конфигурацию sshd_config в действие.

## Запуск плейбука

Для запуска этого плейбука на удаленном хосте, выполните следующую команду:

``` bash
ansible-playbook playbook/configure_ssh_and_user.yaml --ask-vault-pass --become -K


--ask-vault-pass: Этот флаг используется для запроса пароля от vault в интерактивном режиме. Вы должны ввести пароль, который используется для расшифровки зашифрованных данных в файле secrets.vault и ssh_keys.vault.
--become: Этот флаг указывает Ansible использовать привилегии sudo или root (если это необходимо) при выполнении задач, которые требуют повышения привилегий.
-K: Этот флаг запрашивает ваш пароль для доступа к привилегированным командам (обычно это пароль вашего пользователя sudo).
